{% extends "base.html" %}

{% block title %}Reset Password - Gardening Companion{% endblock %}

{% block content %}
    {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div>
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

    <form method="POST" onsubmit="return validatePassword()">
        <label for="password">New Password</label>
        <div class="password-container">
            <input type="password" id="password" name="password" placeholder="Enter new password" minlength="8" maxlength="15" required>
            <button type="button" onclick="togglePassword('password')">Show</button>
        </div>

        <label for="confirm_password">Confirm Password</label>
        <div class="password-container">
            <input type="password" id="confirm_password" name="confirm_password" placeholder="Confirm new password" minlength="8" maxlength="15" required>
            <button type="button" onclick="togglePassword('confirm_password')">Show</button>
        </div>

        <p id="password-error" style="color: red; display: none;">Password must contain at least one letter and one number.</p>

        <button type="submit">Reset Password</button>
    </form>

    
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Attach event listeners to show/hide password buttons
        document.querySelectorAll(".toggle-password").forEach(function (button) {
            button.addEventListener("click", function () {
                var field = document.getElementById(this.dataset.target);
                if (field.type === "password") {
                    field.type = "text";
                    this.textContent = "Hide";
                } else {
                    field.type = "password";
                    this.textContent = "Show";
                }
            });
        });

        // Validate password on form submission
        document.querySelector("form").addEventListener("submit", function (event) {
            var password = document.getElementById("password").value;
            var confirmPassword = document.getElementById("confirm_password").value;
            var passwordError = document.getElementById("password-error");

            var regex = /^(?=.*[A-Za-z])(?=.*\d).{8,}$/; // At least one letter and one number

            if (!regex.test(password)) {
                passwordError.style.display = "block";
                event.preventDefault(); // Stop form submission
                return false;
            } else {
                passwordError.style.display = "none";
            }

            if (password !== confirmPassword) {
                alert("Passwords do not match!");
                event.preventDefault(); // Stop form submission
                return false;
            }

            return true; // Allow form submission
        });
    });
</script>

    
{% endblock %}
